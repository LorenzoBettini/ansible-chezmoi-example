---
- name: Install curl
  become: true
  ansible.builtin.package:
    name: curl
    state: present

- name: Install ZSH
  become: true
  ansible.builtin.package:
    name: zsh
    state: present

- name: Change user shell to zsh 
  become: true
  ansible.builtin.user:
    name: "{{ ansible_user_id }}"
    shell: /bin/zsh

- name: Install chezmoi
  ansible.builtin.shell: sh -c "$(curl -fsLS get.chezmoi.io)" -- -b ~/.local/bin
  args:
    creates: "~/.local/bin/chezmoi"

- name: Initialize chezmoi
  ansible.builtin.command: "~/.local/bin/chezmoi init --apply --verbose {{ chezmoi_init_url }}"
  when: chezmoi_init_url
  args:
    creates: "~/.local/share/chezmoi"